# 前端动画

## 学习准备

对于很多前端工程师来说，动画和可视化是最有趣的技术部分之一，它可以让我们做出体验很好而且很炫的视觉效果，对于很多产品来说，完成一些动画交互是提高用户体验的绝佳方式，目前我们在前端领域实现动画大概分为两种技术方案，一种是用css来实现动画，另外一种是通过JavaScript控制来实现动画效果,下面我们将分别介绍一下CSS动画以及JavaScript动画的比较以及实际应用中的技术选型


### CSS和JavaScript动画的比较

早期的前端开发,很多开发者比较习惯使用jQuery来给元素添加各种动画,其原因是开发成本相对较低而且足以满足产品需求,但是随着项目日渐复杂,各种移动端设备大量增加,导致动画的表现性越来越重要，加之html5和css3的崛起，让我们在制作动画时的选择越来越多，css开发动画的方案也逐渐被人广泛接受。下面我们来比较一下CSS和JavaScript动画的优势及缺陷

#### CSS动画

**优点：**
1.  浏览器使用与 requestAnimationFrame 类似的机制，requestAnimationFrame 会把每一帧中的所有DOM操作集中起来，在一次重绘或回流中就完成,并且重绘或回流的时间间隔紧紧跟随浏览器的刷新频率,一般来说,这个频率为每秒60帧。在隐藏或不可见的元素中requestAnimationFrame不会进行重绘或回流，这当然就意味着更少的的CPU，GPU和内存使用量。
2. 浏览器会为我们优化，它将强制使用硬件加速 （通过 GPU 来提高动画性能）
3. 使用相对简单，不需要很多的学习成本

**缺点：**
1. 运行过程控制较弱,无法附加事件绑定回调函数。CSS动画只能暂停,不能在动画中寻找一个特定的时间点，不能在半路反转动画，不能变换时间尺度，不能在特定的位置添加回调函数或是绑定回放事件,无进度报告
2. 如果很复杂的动画,会导致代码质量变差,可读性降低
3. 兼容性不高,基于 CSS 的动画在 IE9 及之前版本的浏览器兼容性很差
4. 效果有限,CSS动画基于属性的限制,并不能实现有特别有创造性的动画


#### JavaScript动画

**优点：**
1. JavaScript动画控制能力很强, 可以在动画播放过程中对动画进行控制：开始、暂停、回放、终止、取消等操作
2. 效果比CSS动画丰富,有些动画效果，只有JavaScript动画才能完成
3. 兼容性较好,JavaScript动画大多数的时候没有兼容性问题

**缺点：**
1. JavaScript在浏览器的主线程中运行，而主线程中还有其它需要运行的JavaScript脚本、样式计算、布局、绘制任务等,对其干扰导致线程可能出现阻塞，从而造成丢帧的情况
2. 代码整体的复杂度高于CSS动画

#### 两种实现对比

在Chromium项目里，渲染线程分为`main thread`和`compositor thread`。
如果CSS动画只是改变`transforms`和`opacity`，这时整个CSS动画得以在`compositor thread`完成（而JS动画则会在`main thread`执行，然后触发`compositor`进行下一步操作）
在JS执行一些昂贵的任务时，`main thread`繁忙，CSS动画由于使用了`compositor thread`可以保持流畅,所以在常规操作中CSS动画的性能是优于JavaScript动画的,但是JavaScript可以让我们实现内容更丰富的动画,以及兼容性相对更好

### 技术选型

在实际的项目开发中,会面临着技术选型的问题,也就是我实现一个动画,到底是该用CSS还是JavaScript去完成呢?

一般来说我们的技术选型会从以下几个角度去考虑:
1. **兼容性:**我们的项目是否需要兼容低版本的浏览器,如果需要兼容,JavaScript可能是唯一的选择,如果仅仅只适配移动端,动画相对又很简单,我们首选应该是CSS动画
2. **复杂度:**复杂度也是衡量是否用CSS动画的一个重要原因,如果动画需求很精简,不需要很多过程控制,我们可以选择CSS来完成;如果整个动画非常复杂,要求展示的内容特别丰富,而且需要更强的控制能力,则我们需要选择JavaScript来完成
3. **性能:**关于CSS和JavaScript的性能,业内整体争论不断,如果动画不会触发`paint`或`layout`我们的首选将是用CSS来完成

如果动画只是简单的状态切换，不需要中间过程控制，在这种情况下，CSS动画是优选方案。它可以让你将动画逻辑放在样式文件里面，而不会让你的页面充斥 Javascript 库。然而如果你在设计很复杂的富客户端界面或者在开发一个有着复杂UI状态的 APP。那么你应该使用js动画，这样你的动画可以保持高效，并且你的工作流也更可控。所以，在实现一些小的交互动效的时候，就多考虑考虑CSS动画。对于一些复杂控制的动画，使用javascript比较可靠


## CSS动画基础(transition)

早期要实现动画效果，都是依赖于JavaScript或Flash来完成。但在CSS3中新增加了一个新的模块transition，它可以通过一些简单的CSS事件来触发元素的外观变化，让效果显得更加细腻。通过鼠标的单击、获得焦点，被点击或对元素任何改变中触发，并平滑地以动画效果改变CSS的属性值。

`transition` 属性用于设置元素两种状态间的过渡动画,是`transition-property`、`transition-duration` 、`transition-timing-function`、`transition-delay `四个属性的缩写

`transition-property` 用于设置动画属性，它来指定过渡或动态模拟的CSS属性，过渡属性只有具备一个中点值的属性（需要产生动画的属性）才能具备过渡效果，默认值为`all`
`transition-duration` 用于设置动画时长
`transition-timing-function` 用于设置动画时间函数

### transition-timing-function

`transition-timing-function` 主要用于设置动画时间函数，参数见下表：


